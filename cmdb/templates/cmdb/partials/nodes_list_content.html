<div id="nodes-content" 
     class="bg-white shadow rounded-lg overflow-hidden"
     hx-get="{% url 'cmdb:nodes_list' label %}"
     hx-trigger="refresh from:body"
     hx-swap="innerHTML">
    {% include "cmdb/partials/nodes_table.html" %}
</div>

<script>
document.body.addEventListener('nodeCreated', function(evt) {
    // Close modal on success
    document.getElementById('create-modal').close();
    // Refresh table
    htmx.trigger('#nodes-content', 'refresh');
});
document.body.addEventListener('nodeUpdated', function() {
    htmx.trigger('#nodes-content', 'refresh');
});
document.body.addEventListener('nodeDeleted', function() {
    htmx.trigger('#nodes-content', 'refresh');
});
</script>

<!-- Edit Modal -->
<dialog id="edit-modal" 
        class="p-6 rounded-lg shadow-xl max-w-lg w-full backdrop:bg-black backdrop:bg-opacity-50"
        :class="darkMode ? 'dark bg-gray-800 text-white' : 'bg-white'">
    <div id="edit-modal-content"></div>
</dialog>

<!-- Create Modal -->
<dialog id="create-modal" 
        class="p-6 rounded-lg shadow-xl max-w-lg w-full backdrop:bg-black backdrop:bg-opacity-50"
        :class="darkMode ? 'dark bg-gray-800 text-white' : 'bg-white'">
    <div id="create-modal-content" class="space-y-4">
        <h3 class="text-lg font-medium text-gray-900 dark:text-white">Create new {{ label }}</h3>
        
        <form 
            hx-post="{% url 'cmdb:node_create' label %}"
            hx-target="#create-modal-content"
            hx-swap="innerHTML"
            hx-on::after-request="if(event.detail.successful) htmx.trigger('#nodes-content', 'nodeCreated')">
            
            <label for="properties" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Properties (JSON)</label>
            <textarea 
                id="properties" 
                name="properties" 
                rows="6"
                class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm font-mono"
                placeholder='{"name": "New Site", "city": "Atlanta", "country": "US"}'
            ></textarea>

            <div class="mt-4 flex justify-end gap-3">
                <button type="button" onclick="document.getElementById('create-modal').close()" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                    Cancel
                </button>
                <button type="submit" class="px-4 py-2 bg-indigo-600 dark:bg-indigo-700 text-white rounded-md hover:bg-indigo-700 dark:hover:bg-indigo-800">
                    Create
                </button>
            </div>
        </form>
    </div>
</dialog>
