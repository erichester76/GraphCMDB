{% if label == 'Rack' %}
<div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow border border-gray-200 dark:border-gray-700">
    <h4 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-4">Rack Elevation</h4>

    {% if custom_data %}
        <div class="flex gap-6">
            <!-- Rack Details on the Left -->
            <div class="flex-1">
                <div class="space-y-4">
                    <div>
                        <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Rack Information</h5>
                        <p class="text-sm text-gray-600 dark:text-gray-400">
                            Total Height: <span class="font-semibold">{{ custom_data|length }} U</span>
                        </p>
                    </div>
                    
                    <div>
                        <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Installed Devices</h5>
                        <div class="space-y-2">
                            {% for unit in custom_data %}
                                {% if unit.device %}
                                    <div class="text-sm text-gray-600 dark:text-gray-400">
                                        <span class="font-medium text-gray-700 dark:text-gray-300">U{{ unit.number }}:</span>
                                        <a href="{% url 'cmdb:node_detail' unit.device.target_label unit.device.target_id %}" 
                                           class="text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 hover:underline ml-2">
                                            {{ unit.device.target_name|default:unit.device.target_id }}
                                        </a>
                                        {% if unit.status %}
                                            <span class="text-xs text-gray-500 dark:text-gray-400 ml-2">({{ unit.status }})</span>
                                        {% endif %}
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rack Visual on the Right (300px wide) -->
            <div class="w-[300px] flex-shrink-0">
                <div class="border border-gray-300 dark:border-gray-600 rounded bg-gray-50 dark:bg-gray-900 p-2 max-h-[600px] overflow-y-auto shadow-inner">
                    {% for unit in custom_data %}
                    <div class="rack-unit flex items-center justify-between h-10 border-b border-gray-200 dark:border-gray-700 px-4 text-sm {% cycle 'bg-amber-50 dark:bg-gray-800' 'bg-gray-100 dark:bg-gray-700' %}">
                        <span class="font-medium text-gray-900 dark:text-gray-100 min-w-[60px]">U{{ unit.number }}</span>

                        {% if unit.device %}
                            <a href="{% url 'cmdb:node_detail' unit.device.target_label unit.device.target_id %}" 
                               class="text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 hover:underline truncate max-w-[150px]">
                                {{ unit.device.target_name|default:unit.device.target_id|truncatechars:15 }}
                            </a>
                        {% else %}
                            <span class="text-gray-500 dark:text-gray-400 italic text-xs">Empty</span>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    {% else %}
        {% if error %}
            <div class="p-4 bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 rounded">
                {{ error }}
            </div>
        {% else %}
            <p class="text-gray-500 dark:text-gray-400 text-center py-8">No rack units defined or height not set</p>
        {% endif %}
    {% endif %}
</div>
{% endif %}